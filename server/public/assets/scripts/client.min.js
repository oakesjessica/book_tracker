var app=angular.module("bookApp",["ngRoute","smart-table"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/login",{templateUrl:"views/login.html",controller:"LoginController",controllerAs:"log"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterController",controllerAs:"reg"}).when("/search",{templateUrl:"views/search.html",controller:"SearchController",controllerAs:"add"}).when("/library",{templateUrl:"views/library.html",controller:"LibraryController",controllerAs:"lib"}).when("/shelves",{templateUrl:"views/shelves.html",controller:"ShelvesController",controllerAs:"shelf"}).when("/locations",{templateUrl:"views/locations.html",controller:"LocationController",controllerAs:"loc"}).when("/borrowed",{templateUrl:"views/borrowed.html",controller:"BorrowController",controllerAs:"brw"}).when("/lent",{templateUrl:"views/lent.html",controller:"LentController",controllerAs:"lent"}).when("/favorites",{templateUrl:"views/favorites.html",controller:"FavoriteController",controllerAs:"fav"}).when("/wishlist",{templateUrl:"views/wishlist.html",controller:"WishController",controllerAs:"wish"}).when("/faq",{templateUrl:"views/faq.html",controller:"FaqController",controllerAs:"faq"}),b.html5Mode(!0)}]),app.controller("MainController",["UserService",function(a){var b=this;b.loginStatusData=a.data,console.log(b.loginStatus)}]),app.controller("LoginController",["UserService",function(a){var b=this;b.logInfo={},b.login=function(){console.log(b.logInfo),a.loginUser(b.logInfo)}}]),app.controller("RegisterController",["UserService",function(a){var b=this;b.newUser={},b.regUser=function(){console.log(b.newUser),a.registerNewUser(b.newUser),b.newUser={}}}]),app.controller("SearchController",["GoogleAPIService","BookService",function(a,b){var c=this;c.page_title="Search List",c.params={},c.searchInput="",c.searchParameters=["title","author","series"],c.searchResults=a.APIdata,c.submitSearch=function(){var b=c.searchInput.replace(/ /g,"+");console.log(b),a.getAPIResults(b),c.searchInput=""},c.addSearchToLibrary=function(a){if(c.resultInfo={},c.resultInfo.title=a.title,c.resultInfo.authors=a.authors.join(", "),a.publishedDate?c.resultInfo.published_date=a.publishedDate:c.resultInfo.published_date=null,a.publisher?c.resultInfo.publisher=a.publisher:c.resultInfo.publisher=null,a.categories?c.resultInfo.categories=a.categories:c.resultInfo.categories=null,a.pageCount?c.resultInfo.page_count=a.pageCount:c.resultInfo.page_count=null,a.language?c.resultInfo.languages=a.language:c.resultInfo.languages=null,a.description?c.resultInfo.plot=a.description:c.resultInfo.plot=null,a.imageLinks?c.resultInfo.img_src=a.imageLinks.smallThumbnail:c.resultInfo.img_src=null,a.industryIdentifiers)for(var d=0;d<a.industryIdentifiers.length;d++)"ISBN_10"===a.industryIdentifiers[d].type?c.resultInfo.isbn10=a.industryIdentifiers[d].identifier:"ISBN_13"===a.industryIdentifiers[d].type?c.resultInfo.isbn13=a.industryIdentifiers[d].identifier:(c.resultInfo.isbn13=null,c.resultInfo.isbn10=null);else c.resultInfo.isbn13=null,c.resultInfo.isbn10=null;b.addToUserLibrary(c.resultInfo)}}]),app.controller("LibraryController",["BookService",function(a){var b=this;b.page_title="My Library",b.displayLibrary=[],b.libraryList=a.APIdata,a.getLibrary(),b.showHideDetails=function(a){b.expanded!=a.book_id?b.expanded=a.book_id:b.expanded=null}}]),app.controller("ShelvesController",["BookService",function(a){var b=this;b.page_title="Book Shelves",b.displayShelves=[],b.shelvesList=a.data,a.getByShelves()}]),app.controller("LocationController",["BookService",function(a){var b=this;b.page_title="Book Locations",b.locationsList=a.data,a.getByLocations()}]),app.controller("BorrowController",["BookService",function(a){var b=this;b.displayCurrentBorrowedBooks=[],b.displayBorrowedHistory=[],b.table_title="Books I'm Borrowing",b.history_title="Borrowing History",b.borrowingList=a.borrowLentData,a.getBorrowedList(),b.emailBookOwner=function(a){console.log(a),console.log("owner ID",a.book_id,a.owner_id)},b.showHideDetails=function(a){b.expanded!=a.book_id?b.expanded=a.book_id:b.expanded=null},b.returnToOwner=function(a){console.log(a)}}]),app.controller("LentController",["BookService",function(a){var b=this;b.table_title="Books I'm Lending Out",b.history_title="Books I've Lent Out",b.displayCurrentLentBooks=[],b.displayLentHistory=[],b.lendingList=a.borrowLentData,a.getLentList(),b.reminder=function(a){console.log(a),console.log(a.book_id,a.borrower_id)},b.emailBookBorrower=function(a){console.log(a)},b.showHideDetails=function(a){b.expanded!=a.book_id?b.expanded=a.book_id:b.expanded=null},b.returnedFromBorrower=function(a){console.log(a)}}]),app.controller("FavoriteController",["BookService",function(a){var b=this;b.page_title="Favorites List",b.displayFavorites=[],b.favoritesList=a.data,a.getFavoritesList(),b.showHideDetails=function(a){b.expanded!=a.book_id?b.expanded=a.book_id:b.expanded=null},b.removeFavStar=function(b){bootbox.confirm("Remove from favorites?",function(c){c===!0&&a.removeFav(b.book_id)})}}]),app.controller("WishController",["BookService",function(a){var b=this;b.page_title="Wish List",b.displayWishlist=[],b.wishList=a.data,a.getWishlist(),b.removeWishHeart=function(b){bootbox.confirm("Remove from wishlist?",function(c){c===!0&&a.removeWish(b.book_id)})},b.addToLibrary=function(b){bootbox.confirm({title:"Add book to My Library",message:"Add <i>"+b.title+"</i> to your library?",buttons:{cancel:{label:"No",className:"btn btn-sm btn-default"},confirm:{label:"Yes",className:"btn btn-sm btn-primary"}},callback:function(c){c===!0&&bootbox.dialog({title:"Add book to My Library",message:"<h3>You got the book!</h3><br/><br/><strong>Title:</strong> "+b.title+"<br/><strong>Author:</strong> "+b.author+"<br/><strong>Series:</strong> "+b.series+"<br/><strong>Published:</strong> "+moment(b.published).format("MMM DD, YYYY")+"<br/><strong>Plot:</strong> Plot goes here",buttons:{cancel:{label:"Actually, nevermind",className:"btn btn-md btn-default"},add:{label:"Yes! Add to Library!",className:"btn btn-md btn-success",callback:function(){console.log("yes"),a.addToUserLibrary(b)}}}})}})},b.showHideDetails=function(a){b.expanded!=a.book_id?b.expanded=a.book_id:b.expanded=null}}]),app.controller("FaqController",function(){var a=this;a.page_title="FAQ List"}),app.factory("UserService",["$http","$location",function(a,b){var c=[],d={};return registerNewUser=function(c){console.log("newuser",c),a.post("/register",c).then(function(a){console.log(a),b.path("/login")})},loginUser=function(c){console.log("logging in",c),a.post("/",c).then(function(a){console.log(a),200===a.status?(d.login=!0,b.path("/borrowed")):(d.login=!1,b.path("/login"))})},{key:{title:"value"},userData:c,registerNewUser:registerNewUser,loginUser:loginUser,data:d}}]),app.factory("BookService",["$http",function(a){function b(a,b){for(var c={},d=0;d<a.length;d++){var e=a[d][b];c[e]?c[e].push(a[d]):c[a[d][b]]=[a[d]]}return c}var c=[],d=[],e=function(){a.get("/library").then(function(a){angular.copy(a.data,c)})},f=function(){a.get("/wishlist").then(function(a){angular.copy(a.data,c)})},g=function(){a.get("/favorites").then(function(a){angular.copy(a.data,c)})},h=function(){a.get("/borrowed").then(function(a){d.curr=a.data.filter(function(a){return a.status===!0}),d.past=a.data.filter(function(a){return a.status===!1})})},i=function(){a.get("/lent").then(function(a){d.curr=a.data.filter(function(a){return a.status===!0}),d.past=a.data.filter(function(a){return a.status===!1})})},j=function(){a.get("/shelves").then(function(a){c.allShelves=b(a.data,"shelf_name"),console.log(c.allShelves)})},k=function(){a.get("/locations").then(function(a){c.allLocations=b(a.data,"locations")})},l=function(b){a.put("/favorites/"+b).then(function(a){g()})},m=function(b){a["delete"]("/wishlist/"+b).then(function(a){f()})},n=function(b){console.log("adding",b),a.post("/search",b).then(function(a){console.log(a)})};return{key:{title:"value"},getLibrary:e,getWishlist:f,getBorrowedList:h,getLentList:i,getFavoritesList:g,getByShelves:j,getByLocations:k,removeFav:l,removeWish:m,addToUserLibrary:n,data:c,borrowLentData:d}}]),app.factory("GoogleAPIService",["$http",function(a){var b=[],c=function(c){var d={q:c,printType:"books",startIndex:0,maxResults:15,callback:JSON,key:process.env.API_KEY};a.get("https://www.googleapis.com/books/v1/volumes?q="+c+"&printType=books&startIndex="+d.startIndex+"&maxResults="+d.maxResults+"&key="+d.key).then(function(a){b.val=a.data,console.log(b.val)})};return{getAPIResults:c,APIdata:b}}]);